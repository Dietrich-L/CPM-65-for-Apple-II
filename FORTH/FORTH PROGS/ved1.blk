( FULL SCREEN EDITOR      D. Lausberg 31.8.97      SCR #1 )     VOCABULARY VED immediate VED DEFINITIONS                        decimal                                                         1 VARIABLE &MODE    1 VARIABLE &CUR                             1 variable &tag1    1 variable &tag2                            0 variable &BUF                                                 9 constant ht       8 constant bs                               25 constant home                                                1023 constant cps  15 constant lps                              : nbs 0 do bs emit loop ;                                                                                                       : CLS 12 EMIT ;                                                 : nvt dup 0= if drop else 0 do 31 emit loop endif ;             : xcr 13 emit lps < if 10 emit endif ;                          : .L (LINE) -trailing 1 max type ;                              -->                                                             ( FULL SCREEN EDITOR                                SCR #2 )    : curpos &cur @ ;                                               : !cur &cur ! ;                                                 : >line# c/l / ;                                                : line#> c/l * ;                                                : line@ scr @ (line) ;                                          : bufpos curpos >line# line@ drop curpos c/l mod +                  dup &BUF ! ;                                                : +1BUF &BUF @ 1+ &BUF ! ;                                      : +1cur curpos 1+ dup cps > if drop cps bs emit endif !cur ;    : -1cur curpos 1 - dup 0 < if drop 0 ht emit endif !cur ;       : #toeol c/l mod c/l swap - ;                                                                                                   -->                                                                                                                                                                                             ( Full Screen Editor                                  SCR #3 )  : ?prt dup bl < swap 126 > or 0= ;                              : nop ;                                                         : exec swap 2 * + @ execute ;                                                                                                                                                                   : larrow -1cur bs emit ;                                        : rarrow +1cur ht emit ;                                        : uarrow curpos c/l - dup 0 < if drop curpos else                 31 emit endif !cur ;                                          : darrow curpos c/l + dup cps > if drop curpos else               10 emit endif !cur ;                                                                                                          : imode &mode  @ -1 xor &mode ! ; ( toggle insert mode )                                                                        -->                                                             ( Full Screen Editor                               SCR #4 )     : distoeos 13 emit dup line#> !cur lps 1+ over do i scr @         .L i xcr loop 15 swap - nvt ;                                 : updscr cls 0 distoeos ;                                       : scr-ini updscr ;                                              : nxtblk 1 scr +! scr-ini ;                                     : lstblk scr @ 1 - dup 1 < if drop 1 endif                        scr ! scr-ini ;                                               : quit-ed cls ." edit complete" flush forth quit ;                                                                              : clrline line@ blanks update ;                                 : ?empty line@ -trailing swap drop 0= ;                         : -move line@ cmove update ;                                    : exp dup 1 - 14 do i line@ drop i 1+ -move -1 +loop              clrline ;                                                     -->                                                             ( Full Screen Editor                                 SCR #5 )   : shrink lps dup rot do i 1+ line@ drop i -move loop              clrline ;                                                     : clear-page 16 0 do I clrline loop updscr ;                    : copy b/scr * offset @ + swap b/scr * b/scr over + swap          do dup I block 2 - ! 1+ update loop drop flush ;                                                                              : insertline lps ?empty if dup exp distoeos                       endif ;                                                       : deleteline dup shrink distoeos ;                              : clp clear-page ;                                              : iline curpos >line# insertline ;                              : dline curpos >line# deleteline ;                                                                                              : tab 8 curpos 8 mod - 0 do +1cur ht emit loop ;                -->                                                             ( Full Screen Editor                              SCR #6 )      : #in pad 10 expect 0 0 pad 1 - (number) drop drop ;            : edits cls ."   Edit SCR #: " #in scr ! scr-ini ;                                                                              : settag scr @ key dup 49 = if swap &tag1 ! endif                                      50 = if &tag2 ! else drop endif ;        : totag key dup 49 = if &tag1 @ scr ! scr-ini endif                             50 = if &tag2 @ scr ! scr-ini endif ;                                                                           : REP pad 1+ swap -move ;                                       : holdln curpos >line# line@ pad c! pad 1+ c/l cmove ;          : putln curpos >line# dup &mode @ if                                    lps ?empty if dup exp REP else drop endif                   else REP endif distoeos ;                                                                                                   -->                                                             ( Full Screen Editor                                 SCR #7 )   : ret &mode @ if iline else curpos >line# 1+ dup 15 <             if 10 emit endif 15 min line#> !cur 29 emit endif ;                                                                           : delchar bufpos dup >R dup 1+ swap curpos #toeol 1 - dup         >R cmove R> R> + bl swap c! update ;                          : distoeol bufpos swap #toeol -trailing 1+ swap                   over type nbs ;                                               : dchar delchar curpos distoeol ;                               : inschar dup >R here over over curpos #toeol 1 -                 dup >R cmove swap 1+ R> cmove R> c! update ;                  : ins-page scr @ eom @ lo - 1024 / 4 +                            do i 1 - i copy -1 +loop clear-page ;                         : RUBOUT larrow dchar ;                                         : .mode 18 spaces &mode @ if ." INSERT " else 7 spaces endif ;  ;S                                                              